import React, { useEffect, useState } from "react";
import axios from "axios";
import {
    Box,
    Typography,
    Button,
    Checkbox,
    FormControlLabel,
    FormGroup,
    CircularProgress
} from "@mui/material";

const Profile = () => {
    const [ingredients, setIngredients] = useState([]);
    const [selectedIngredients, setSelectedIngredients] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const fetchIngredients = async () => {
            try {
                const response = await axios.get("http://localhost:5000/api/ingredients"); // adjust this route
                setIngredients(response.data); // assuming it returns an array of { _id, name }
                setLoading(false);
            } catch (error) {
                console.error("Error fetching ingredients:", error);
                setLoading(false);
            }
        };

        fetchIngredients();
    }, []);

    const handleToggle = (id) => {
        setSelectedIngredients((prev) =>
            prev.includes(id) ? prev.filter((item) => item !== id) : [...prev, id]
        );
    };

    const handleFindRecipes = () => {
        // you can either navigate or send the selectedIngredients to an endpoint
        console.log("Selected ingredients:", selectedIngredients);
    };

    if (loading) return <CircularProgress />;

    return (
        <Box sx={{ p: 4 }}>
            <Typography variant="h4" gutterBottom>
                Welcome back, bestie ðŸ’–
            </Typography>

            <Typography variant="h6" sx={{ mt: 3 }}>
                What ingredients do you have?
            </Typography>

            <FormGroup>
                {ingredients.map((ingredient) => (
                    <FormControlLabel
                        key={ingredient._id}
                        control={
                            <Checkbox
                                checked={selectedIngredients.includes(ingredient._id)}
                                onChange={() => handleToggle(ingredient._id)}
                            />
                        }
                        label={ingredient.name}
                    />
                ))}
            </FormGroup>

            <Button
                variant="contained"
                color="primary"
                sx={{ mt: 3 }}
                onClick={handleFindRecipes}
            >
                Find Recipes
            </Button>
        </Box>
    );
};

export default Profile;
