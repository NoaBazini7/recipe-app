import React, {useEffect, useState} from "react";
import axios from "axios";
import {Box, Button, Checkbox, CircularProgress, FormControlLabel, Typography,} from "@mui/material";
import "../App.css";
import EmojiFoodBeverageIcon from "@mui/icons-material/EmojiFoodBeverage";

const ProfilePage = () => {
    const [ingredients, setIngredients] = useState([]);
    const [selectedIngredients, setSelectedIngredients] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const fetchIngredients = async () => {
            try {
                const response = await axios.get("http://localhost:5000/api/ingredients");
                setIngredients(response.data);
                setLoading(false);
            } catch (error) {
                console.error("Error fetching ingredients:", error);
                setLoading(false);
            }
        };

        fetchIngredients();
    }, []);

    const handleToggle = (id) => {
        setSelectedIngredients((prev) =>
            prev.includes(id) ? prev.filter((item) => item !== id) : [...prev, id]
        );
    };

    const handleFindRecipes = () => {
        console.log("Selected ingredients:", selectedIngredients);
    };

    if (loading) return <CircularProgress/>;

    const handleToggleIngredient = (id) => {
        setSelectedIngredients((prevSelected) =>
            prevSelected.includes(id)
                ? prevSelected.filter((item) => item !== id)
                : [...prevSelected, id]
        );
    };


    return (
        <div className="profile-container">
            <h1>Welcome to your profile!</h1>
            <Box minWidth={1000} mx="auto" textAlign="center">
                <Typography variant="h2" gutterBottom>
                    Your Ingredient Stash ðŸ§‚
                </Typography>

                <div className="ingredients-box">
                    {ingredients.map((ingredient) => (
                        <FormControlLabel
                            key={ingredient._id}
                            control={
                                <Checkbox
                                    checked={selectedIngredients.includes(ingredient._id)}
                                    onChange={() => handleToggleIngredient(ingredient._id)}
                                    style={{color: "#E43D12"}}
                                />
                            }
                            label={
                                <span style={{display: "flex", alignItems: "center"}}>
                                <EmojiFoodBeverageIcon style={{fontSize: "1rem", marginRight: 6}}/>
                                    {ingredient.name}
    </span>
                            }
                        />
                    ))}
                </div>

                <Button
                    className="find-recipes-button"
                    onClick={handleFindRecipes}
                >
                    Find Recipes
                </Button>
            </Box>
        </div>
    );
};

export default ProfilePage;
